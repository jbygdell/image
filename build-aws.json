{
   "variables":{
      "aws_access_key_id":"{{env `AWS_ACCESS_KEY_ID`}}",
      "aws_secret_access_key":"{{env `AWS_SECRET_ACCESS_KEY`}}",
      "aws_filter_name":"{{env `AWS_FILTER_NAME`}}",
      "current_version":"{{env `CURRENT_VERSION`}}",
      "image_name":"{{env `IMAGE_NAME`}}"
   },
   "builders":[
      {
         "name":"aws-ca-central-1",
         "type":"amazon-ebs",
         "access_key":"{{user `aws_access_key_id`}}",
         "ami_name":"{{user `image_name`}}",
         "ami_description":"{{user `image_name`}}",
         "ami_groups":"all",
         "instance_type":"t2.medium",
         "region":"ca-central-1",
         "secret_key":"{{user `aws_secret_access_key`}}",
         "ssh_username":"ubuntu",  
         "source_ami_filter": {
            "filters": {
                "virtualization-type": "hvm",
                "name":"{{user `aws_filter_name`}}",
                "root-device-type": "ebs"   
            },
            "owners": ["099720109477"],
            "most_recent": true
         }
      },
      {
         "name":"aws-eu-central-1",
         "type":"amazon-ebs",
         "access_key":"{{user `aws_access_key_id`}}",
         "ami_name":"{{user `image_name`}}",
         "ami_description":"{{user `image_name`}}",
         "ami_groups":"all",
         "instance_type":"t2.medium",
         "region":"eu-central-1",
         "secret_key":"{{user `aws_secret_access_key`}}",
         "ssh_username":"ubuntu",
         "source_ami_filter": {
            "filters": {
                "virtualization-type": "hvm",
                "name":"{{user `aws_filter_name`}}",
                "root-device-type": "ebs"
            },
            "owners": ["099720109477"],
            "most_recent": true
         }
          
      },
      {
         "name":"aws-eu-west-1",
         "type":"amazon-ebs",
         "access_key":"{{user `aws_access_key_id`}}",
         "ami_name":"{{user `image_name`}}",
         "ami_description":"{{user `image_name`}}",
         "ami_groups":"all",
         "instance_type":"t2.medium",
         "region":"eu-west-1",
         "secret_key":"{{user `aws_secret_access_key`}}",
         "ssh_username":"ubuntu",
         "source_ami_filter": {
            "filters": {
                "virtualization-type": "hvm",
                "name":"{{user `aws_filter_name`}}",
                "root-device-type": "ebs"
            },
            "owners": ["099720109477"],
            "most_recent": true
         }
      },
      {
         "name":"aws-eu-west-2",
         "type":"amazon-ebs",
         "access_key":"{{user `aws_access_key_id`}}",
         "ami_name":"{{user `image_name`}}",
         "ami_description":"{{user `image_name`}}",
         "ami_groups":"all",
         "instance_type":"t2.medium",
         "region":"eu-west-2",
         "secret_key":"{{user `aws_secret_access_key`}}",
         "ssh_username":"ubuntu",
         "source_ami_filter": {
            "filters": {
                "virtualization-type": "hvm",
                "name":"{{user `aws_filter_name`}}",
                "root-device-type": "ebs"
            },
            "owners": ["099720109477"],
            "most_recent": true
         }
      },
      {
         "name":"aws-us-east-1",
         "type":"amazon-ebs",
         "access_key":"{{user `aws_access_key_id`}}",
         "ami_name":"{{user `image_name`}}",
         "ami_description":"{{user `image_name`}}",
         "ami_groups":"all",
         "instance_type":"m3.medium",
         "region":"us-east-1",
         "secret_key":"{{user `aws_secret_access_key`}}",
         "ssh_username":"ubuntu",
         "source_ami_filter": {
            "filters": {
                "virtualization-type": "hvm",
                "name":"{{user `aws_filter_name`}}",
                "root-device-type": "ebs"
            },
            "owners": ["099720109477"],
            "most_recent": true
         }
      },
      {
         "name":"aws-us-east-2",
         "type":"amazon-ebs",
         "access_key":"{{user `aws_access_key_id`}}",
         "ami_name":"{{user `image_name`}}",
         "ami_description":"{{user `image_name`}}",
         "ami_groups":"all",
         "instance_type":"t2.medium",
         "region":"us-east-2",
         "secret_key":"{{user `aws_secret_access_key`}}",
         "ssh_username":"ubuntu",
         "source_ami_filter": {
            "filters": {
                "virtualization-type": "hvm",
                "name":"{{user `aws_filter_name`}}",
                "root-device-type": "ebs"
            },
            "owners": ["099720109477"],
            "most_recent": true
         }
      },
      {
         "name":"aws-us-west-1",
         "type":"amazon-ebs",
         "access_key":"{{user `aws_access_key_id`}}",
         "ami_name":"{{user `image_name`}}",
         "ami_description":"{{user `image_name`}}",
         "ami_groups":"all",
         "instance_type":"t2.medium",
         "region":"us-west-1",
         "secret_key":"{{user `aws_secret_access_key`}}",
         "ssh_username":"ubuntu",
         "source_ami_filter": {
            "filters": {
                "virtualization-type": "hvm",
                "name":"{{user `aws_filter_name`}}",
                "root-device-type": "ebs"
            },
            "owners": ["099720109477"],
            "most_recent": true
         }
      },
      {
         "name":"aws-us-west-2",
         "type":"amazon-ebs",
         "access_key":"{{user `aws_access_key_id`}}",
         "ami_name":"{{user `image_name`}}",
         "ami_description":"{{user `image_name`}}",
         "ami_groups":"all",
         "instance_type":"t2.medium",
         "region":"us-west-2",
         "secret_key":"{{user `aws_secret_access_key`}}",
         "ssh_username":"ubuntu",
         "source_ami_filter": {
            "filters": {
                "virtualization-type": "hvm",
                "name":"{{user `aws_filter_name`}}",
                "root-device-type": "ebs"
            },
            "owners": ["099720109477"],
            "most_recent": true
         }
      }
   ],
   "provisioners":[
      {
         "type":"shell",
         "script":"{{pwd}}/requirements.sh"
      }
   ]
}